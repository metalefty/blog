+++
date = "2020-06-29"
draft = false
lastmod = "2020-06-30T00:02:05+09:00"
title = ""
+++



私がメンテナンスしているSoftEtherVPNのFreeBSDパッケージで、通信スループット測定ツール(TrafficServer)の構築ができるようになったので構築方法を紹介します。

FreeBSDにおいては、3つのバージョンのSoftEtherVPNが利用できます。以下のバージョンから、お好みのものを選択してインストールしてください。

* softether
* softether-devel
* softether5

※ Raspberry Pi など、非x86プロセッサアーキテクチャの環境で利用する場合は **softether5** をインストールしてください。

```
```

以下のコミットで対応しています。`pkg install` する場合は、2020年7月以降にインストールすると、TrafficServer対応版がインストールできます。


* https://svnweb.freebsd.org/changeset/ports/540773
* https://svnweb.freebsd.org/changeset/ports/540774

通信スループット測定サーバを実行するには、以下のようにして softether_trafficserver サービスを実行します。

```
```

これで通信スループット測定サーバが実行されました。サーバは9821番ポートで待ち受けています。あとは、GUIの測定ツールから当該サーバを指定すると通信スループットをテストできます。

<img src="https://lh3.googleusercontent.com/pw/ACtC-3eZBe-oWOjWtt5o88cnbGsZptYMN3Ajw4SDaf8uLmSNtJatzhByQzaHNo__cDlFeTSQF7IM-eb4cNa9SS3iUf90iHIlvIi99RV3MVykPP8KgDPq6A5gRd7tG-5q_trcEEL-Rbhw9uowXzu3kX6SDHDfEg=w792-no" alt="SoftEtherVPN 通信スループット測定ツール">

<img src="https://lh3.googleusercontent.com/pw/ACtC-3cAftPL-rgSMDfrVKlCv9ZFtCv7YYHeLXb1K0nf6z2BVHi-Z5cj45IhMBa1VwM2szsFcKt9fEmLd0EWuq-SF-Q5IFbe0l9ac9KpqHkqo_lP8WE4pT1cnus-eAMlDtmAM3x_ihm0dCmaYijgP7DIh2eYAA=w662-h472-no" alt="SoftEtherVPN 通信スループット測定結果">

あるいは、CLIツールを使用して以下のように測定を実行することも可能です。

```
$ vpncmd /TOOLS /CMD:TrafficClient localhost
(snip)
通信スループット測定ツールによる測定結果  
  
項目名 | 通常の表示| 省略表示  
----------------------------------+--------------------+------------  
測定に使用した時間 | 00:00:15.010|  
Ethernet フレーム用にデータ補正 | はい|  
ダウンロード方向の通信データ量 |25,610,593,346 Bytes|25.61 GBytes  
アップロード方向の通信データ量 |25,615,098,993 Bytes|25.62 GBytes  
合計通信データ量 |51,225,692,339 Bytes|51.23 GBytes  
中継機器入出力合計スループット算出| いいえ|  
ダウンロード方向の平均スループット| 13,649,883,195 bps| 13.65 Gbps  
アップロード方向の平均スループット| 13,652,284,606 bps| 13.65 Gbps  
合計平均スループット | 27,302,167,801 bps| 27.30 Gbps  
コマンドは正常に終了しました。
```

IPv4/IPv6 両対応のクラウドなどに設置して、PPPoE/IPoEの速度比較に使うといいかもしれません。


