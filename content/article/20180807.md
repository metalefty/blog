+++
date = "2018-08-07"
draft = false
lastmod = "2018-08-10T10:04:21+09:00"
tags = ["Network", "雑記"]
title = "Route 53 Health CheckのUser-Agent"
+++


Amazon Route 53 Health Check で HTTP/HTTPS でヘルスチェックするときの User-Agent が変わってました。

新旧はこんな感じ(UUIDはダミーです)。

旧:
```
Amazon Route 53 Health Check Service; ref:b0eb04d5-cb5e-40e7-839b-558e52fc3f0d; report http://amzn.to/1vsZADi
```

新:
```
Amazon-Route53-Health-Check-Service (ref b0eb04d5-cb5e-40e7-839b-558e52fc3f0d; report http://amzn.to/1vsZADi)
```


Apache 側で以下のようにしてヘルスチェックのアクセスはログに残さないようにしていたので、User-Agent が変わっていていつのまにか全部ログに残っていました。

```
SetEnvIf      User-Agent      "Amazon Route 53 Health Check Service;.*"       nolog
CustomLog     /path/to/access_log combined env=!nolog
```

ログによると、JSTで **11/Jul/2018:02:03:16 +0900** からこのUser-Agentでアクセスしているっぽい。


ちょっとググったところ、以下のAWSフォーラムの投稿が見つかりました。以前のUser-Agentのセミコロンの使い方がよくないということで、それを反映した変更っぽい？ RFC7231を斜め読みしただけではいまいちよく理解できてないけど、`( )` の中にセミコロンが登場するのは許されるということだろうか。

* https://forums.aws.amazon.com/thread.jspa?threadID=248461



